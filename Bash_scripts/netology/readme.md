Задача: Есть приложение, которое в промежутке времени с 9 до 23, пишет много «тяжелых» файлов в одну определенную директорию - /opt/app/bigfiles. Проблема в том, что чем чаще мы пишем данным приложением наши тяжеловесные файлы, тем быстрее заканчивается место на разделе, куда примонтирована директория с ними. При анализе данной проблемы было определенно несколько ключевых моментов:
1. Обращения к записанным данным происходит редко и чем старше файл, тем реже вероятность, что его будут читать.
2. Хранить надо файлы за 5 лет работы приложения.
3. Приложение умеет читать файл по ссылке на него.
4. У нас есть хранилище с медленными дисками, но большим объемом.
5. В промежутке с 23 до 9 нагрузка на дисковую систему и сеть минимальная.
6. Файлы имеют определенный шаблон по имени (все файлы начинаются со слова test-хеш-дата-время.avi).

Решение: Необходимо написать скрипт, который бы выполнял следующие задачи:
1. Проверял в основной директории наличие файлов старше 30 дней (Файлы которые последний раз модифицировались более 30 дней назад.) Формировал список файлов старше 30 дней.
2. Перемещал сформированный список в более объемное и медленное хранилище, примонтированое к нашей файловой системе. (Для примера можно использовать любые директории какие вам удобно.)
3. Создать в директории откуда переместили файл, ссылку на перемещенный файл.
4. Удалять файлы старше 5 лет.
5. Добавить скрипт в cron

Сделать файл скрипта исполняемым

$ chmod +x mvfiles.sh

Добавить расписание в cron

$ crontab -e

0 1 * * * mvfiles.sh
